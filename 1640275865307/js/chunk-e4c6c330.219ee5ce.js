(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e4c6c330"],{1759:function(t,e,a){},"3c97":function(t,e,a){},8403:function(t,e,a){"use strict";var r=a("3c97"),i=a.n(r);i.a},"99d8":function(t,e,a){"use strict";var r=a("1759"),i=a.n(r);i.a},a010:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"room",style:{marginTop:t.$route.meta.noHeader?"0px":"60px"}},[a("section",{staticClass:"video-content"},[a("div",{staticClass:"video-content-header"},[a("div",{staticClass:"video-content-header-avatar"},[a("img",{attrs:{src:t.roomDetail.avatar}})]),a("div",[a("div",{staticClass:"video-content-header-title"},[t._v(t._s(t.roomDetail.title))]),a("div",{staticClass:"video-content-header-anchor"},[t._v(t._s(t.roomDetail.name))])])]),a("div",{staticClass:"video-content-main"},[a("BarrageStream"),a("video",{attrs:{id:"videoElement",width:"100%",height:"100%",controls:""}})],1)]),a("section",{staticClass:"chat-content"},[a("Barrage")],1)])},i=[],s=(a("99af"),a("96cf"),a("1da1")),n=a("5530"),o=a("1947"),c=a("a7fe"),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"barrage"},[a("h3",[t._v("弹幕列表")]),a("div",{staticClass:"live-line"}),a("section",{ref:"barrageList",staticClass:"barrage-body",attrs:{id:"barrageList"}},t._l(t.barrageMsgList,(function(e,r){return a("div",{key:r},[t._v(" "+t._s(e.user)+":"+t._s(e.msg)+" ")])})),0),a("div",{staticClass:"live-line"}),a("section",{staticClass:"barrage-msg"},[a("Input",{staticStyle:{width:"200px"},attrs:{maxlength:"20","show-word-limit":"",placeholder:"请输入弹幕"},on:{"on-enter":t.chatLiveRoom},model:{value:t.battageMsg,callback:function(e){t.battageMsg=e},expression:"battageMsg"}}),a("Button",{staticStyle:{"margin-left":"20px",width:"80px"},attrs:{type:"primary"},on:{click:t.chatLiveRoom}},[t._v("发送")])],1)])},g=[],u=(a("b0c0"),a("2b0e")),m=(new u["a"],a("2f62")),d={data:function(){return{battageMsg:"",livingRoom:""}},computed:Object(n["a"])({},Object(m["d"])({barrageMsgList:function(t){return t.barrage.barrageMsgList},currentUser:function(t){return t.user.currentUser}})),mounted:function(){var t=this;this.livingRoom=c["a"].getUrlParam("room"),console.log(this.livingRoom),this.joinLiveRoom(this.livingRoom),this.$socketBarrage.on("chatLiveRoom",(function(e){t.pushbarrageMsgList(e),t.$nextTick((function(){t.$refs.barrageList.scrollTop=t.$refs.barrageList.clientHeight}))}))},beforeDestroy:function(){this.leaveLiveRoom(this.livingRoom)},methods:Object(n["a"])(Object(n["a"])({},Object(m["c"])(["pushbarrageMsgList"])),{},{joinLiveRoom:function(t){this.$sockBarrage.joinRoom(t)},leaveLiveRoom:function(t){console.log(t),this.$sockBarrage.leaveRoom(t)},chatLiveRoom:function(){if(console.log(this.currentUser),this.currentUser.id)if(this.battageMsg){var t={room:this.livingRoom,func:"chatLiveRoom",data:{id:c["a"].getCode(8),user:this.currentUser.name,msg:this.battageMsg}};this.$sockBarrage.roomChat(t),this.battageMsg=""}else this.$Message.error("请输入弹幕内容！");else this.$Message.error("请登录后再发言~")}})},h=d,v=(a("99d8"),a("2877")),b=Object(v["a"])(h,l,g,!1,null,null,null),f=b.exports,L=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"barrageStream",staticClass:"barrage-stream"},t._l(t.barrageStreamList,(function(e,r){return a("div",{key:"barrageStreamList"+r,staticClass:"barrage-block"},t._l(e,(function(e){return a("div",{key:e.id,staticClass:"barrage-block-item"},[t._v(" "+t._s(e.msg)+" ")])})),0)})),0)},p=[],R={name:"barrageStream",data:function(){return{barrageStreamRect:{},barrageStreamList:[],barrageStreamListNum:null}},computed:Object(n["a"])({},Object(m["d"])({barrageMsgList:function(t){return t.barrage.barrageMsgList}})),methods:Object(n["a"])(Object(n["a"])({},Object(m["c"])(["unshiftbarrageMsgList"])),{},{getBarrageStreamList:function(){console.log(this.$refs.barrageStream.getBoundingClientRect()),this.barrageStreamRect=this.$refs.barrageStream.getBoundingClientRect(),this.barrageStreamListNum=Math.floor((this.barrageStreamRect.height-100)/36),this.barrageStreamList=[];for(var t=0;t<this.barrageStreamListNum;t++)this.barrageStreamList.push([]);console.log(this.barrageStreamList)}}),watch:{barrageMsgList:{handler:function(t){var e=this;if(t.length){var a=Math.floor(Math.random()*this.barrageStreamListNum);this.barrageStreamList[a].push(t[t.length-1]),setTimeout((function(){e.barrageStreamList[a].shift()}),5e3)}},deep:!0}},mounted:function(){this.getBarrageStreamList(),window.addEventListener("resize",this.getBarrageStreamList)},beforeDestroy:function(){window.removeEventListener("resize",this.getBarrageStreamList)}},S=R,M=(a("d3dd"),Object(v["a"])(S,L,p,!1,null,"2289bce0",null)),y=M.exports,w={data:function(){return{roomDetail:{}}},components:{Barrage:f,BarrageStream:y},computed:Object(n["a"])({},Object(m["d"])({barrageMsgList:function(t){return t.barrage.barrageMsgList}})),created:function(){},mounted:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.$router.history.current.query,t.livingRoom=a.room,e.next=4,t.$api.livingRoomApi.getRoomDetail({id:t.livingRoom});case 4:t.roomDetail=e.sent,t.$nextTick((function(){if(o["a"].isSupported()){var e=document.getElementById("videoElement");t.flvPlayer=o["a"].createPlayer({type:"flv",url:"".concat(t.$baseEnv.livingUrl,"/").concat(t.livingRoom,".flv")}),t.flvPlayer.attachMediaElement(e);try{t.flvPlayer.load(),t.flvPlayer.play()}catch(a){console.log("error")}}}));case 6:case"end":return e.stop()}}),e)})))()}},C=w,_=(a("8403"),Object(v["a"])(C,r,i,!1,null,"05f3bf76",null));e["default"]=_.exports},a30c:function(t,e,a){},d3dd:function(t,e,a){"use strict";var r=a("a30c"),i=a.n(r);i.a}}]);